<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test - XYLMCSCICS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover { background: #0056b3; }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ Firebase Configuration Test</h1>
    
    <div class="test-section">
        <h2>Firebase Status Check</h2>
        <div id="firebaseStatus" class="status info">Checking Firebase status...</div>
        <button class="test-button" onclick="checkFirebaseStatus()">Check Status</button>
        <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h2>Authentication Test</h2>
        <button class="test-button" onclick="testAuth()">Test Authentication</button>
        <button class="test-button" onclick="testSignup()">Test Signup</button>
        <button class="test-button" onclick="testLogin()">Test Login</button>
    </div>
    
    <div class="test-section">
        <h2>Firestore Test</h2>
        <button class="test-button" onclick="testFirestore()">Test Firestore Connection</button>
        <button class="test-button" onclick="testWrite()">Test Write Operation</button>
        <button class="test-button" onclick="testRead()">Test Read Operation</button>
    </div>
    
    <div class="test-section">
        <h2>Console Log</h2>
        <div id="logOutput" class="log">Waiting for tests...</div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
    
    <script>
        let logOutput = '';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logOutput += logEntry;
            document.getElementById('logOutput').textContent = logOutput;
            
            // Also log to console
            if (type === 'error') {
                console.error(message);
            } else if (type === 'warning') {
                console.warn(message);
            } else {
                console.log(message);
            }
        }
        
        function clearLog() {
            logOutput = '';
            document.getElementById('logOutput').textContent = logOutput;
        }
        
        function updateStatus(message, type) {
            const statusDiv = document.getElementById('firebaseStatus');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function checkFirebaseStatus() {
            log('üîç Checking Firebase status...');
            
            try {
                if (typeof firebase === 'undefined') {
                    updateStatus('‚ùå Firebase SDK not loaded', 'error');
                    log('‚ùå Firebase SDK not loaded', 'error');
                    return;
                }
                
                if (firebase.apps.length === 0) {
                    updateStatus('‚ùå Firebase not initialized', 'error');
                    log('‚ùå Firebase not initialized', 'error');
                    return;
                }
                
                log('‚úÖ Firebase SDK loaded successfully');
                log('‚úÖ Firebase app initialized');
                
                // Check Auth
                if (firebase.auth) {
                    log('‚úÖ Firebase Auth available');
                } else {
                    log('‚ùå Firebase Auth not available', 'error');
                }
                
                // Check Firestore
                if (firebase.firestore) {
                    log('‚úÖ Firebase Firestore available');
                } else {
                    log('‚ùå Firebase Firestore not available', 'error');
                }
                
                // Check if our config variables are available
                if (window.db) {
                    log('‚úÖ Firestore instance available');
                } else {
                    log('‚ùå Firestore instance not available', 'error');
                }
                
                if (window.auth) {
                    log('‚úÖ Auth instance available');
                } else {
                    log('‚ùå Auth instance not available', 'error');
                }
                
                updateStatus('‚úÖ Firebase Ready', 'success');
                
            } catch (error) {
                updateStatus('‚ùå Error checking Firebase', 'error');
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function testAuth() {
            log('üß™ Testing Firebase Authentication...');
            
            try {
                if (!firebase.auth) {
                    log('‚ùå Firebase Auth not available', 'error');
                    return;
                }
                
                log('‚úÖ Firebase Auth is available');
                log('‚úÖ Auth test completed successfully');
                
            } catch (error) {
                log(`‚ùå Auth test failed: ${error.message}`, 'error');
            }
        }
        
        function testSignup() {
            log('üß™ Testing Firebase Signup...');
            
            try {
                if (!firebase.auth) {
                    log('‚ùå Firebase Auth not available', 'error');
                    return;
                }
                
                const testEmail = 'test' + Date.now() + '@example.com';
                const testPassword = 'testpass123';
                
                log(`üìù Attempting signup with: ${testEmail}`);
                
                firebase.auth().createUserWithEmailAndPassword(testEmail, testPassword)
                    .then((userCredential) => {
                        log(`‚úÖ Test signup successful: ${userCredential.user.uid}`);
                        
                        // Clean up test user
                        return userCredential.user.delete();
                    })
                    .then(() => {
                        log('‚úÖ Test user cleaned up');
                    })
                    .catch((error) => {
                        if (error.code === 'auth/email-already-in-use') {
                            log('‚ö†Ô∏è Test user already exists (expected)', 'warning');
                        } else {
                            log(`‚ùå Test signup failed: ${error.message}`, 'error');
                        }
                    });
                
            } catch (error) {
                log(`‚ùå Signup test failed: ${error.message}`, 'error');
            }
        }
        
        function testLogin() {
            log('üß™ Testing Firebase Login...');
            
            try {
                if (!firebase.auth) {
                    log('‚ùå Firebase Auth not available', 'error');
                    return;
                }
                
                const testEmail = 'nonexistent@example.com';
                const testPassword = 'wrongpassword';
                
                log(`üîê Attempting login with: ${testEmail}`);
                
                firebase.auth().signInWithEmailAndPassword(testEmail, testPassword)
                    .then((userCredential) => {
                        log(`‚úÖ Test login successful: ${userCredential.user.email}`);
                    })
                    .catch((error) => {
                        if (error.code === 'auth/user-not-found') {
                            log('‚úÖ Test login failed as expected (user not found)');
                        } else {
                            log(`‚ùå Test login failed: ${error.message}`, 'error');
                        }
                    });
                
            } catch (error) {
                log(`‚ùå Login test failed: ${error.message}`, 'error');
            }
        }
        
        function testFirestore() {
            log('üß™ Testing Firestore connection...');
            
            try {
                if (!firebase.firestore) {
                    log('‚ùå Firebase Firestore not available', 'error');
                    return;
                }
                
                if (!window.db) {
                    log('‚ùå Firestore instance not available', 'error');
                    return;
                }
                
                log('‚úÖ Firestore is available');
                log('‚úÖ Firestore connection test completed');
                
            } catch (error) {
                log(`‚ùå Firestore test failed: ${error.message}`, 'error');
            }
        }
        
        function testWrite() {
            log('üß™ Testing Firestore write operation...');
            
            try {
                if (!window.db) {
                    log('‚ùå Firestore instance not available', 'error');
                    return;
                }
                
                const testData = {
                    test: true,
                    timestamp: new Date().toISOString(),
                    message: 'Test write operation'
                };
                
                log('üìù Attempting to write test data...');
                
                window.db.collection('test').doc('write-test').set(testData)
                    .then(() => {
                        log('‚úÖ Test write successful');
                    })
                    .catch((error) => {
                        log(`‚ùå Test write failed: ${error.message}`, 'error');
                    });
                
            } catch (error) {
                log(`‚ùå Write test failed: ${error.message}`, 'error');
            }
        }
        
        function testRead() {
            log('üß™ Testing Firestore read operation...');
            
            try {
                if (!window.db) {
                    log('‚ùå Firestore instance not available', 'error');
                    return;
                }
                
                log('üìñ Attempting to read test data...');
                
                window.db.collection('test').doc('write-test').get()
                    .then((doc) => {
                        if (doc.exists) {
                            log('‚úÖ Test read successful');
                            log(`üìÑ Data: ${JSON.stringify(doc.data(), null, 2)}`);
                        } else {
                            log('‚ö†Ô∏è Test document does not exist (run write test first)', 'warning');
                        }
                    })
                    .catch((error) => {
                        log(`‚ùå Test read failed: ${error.message}`, 'error');
                    });
                
            } catch (error) {
                log(`‚ùå Read test failed: ${error.message}`, 'error');
            }
        }
        
        // Auto-check status when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Page loaded, starting Firebase tests...');
            setTimeout(checkFirebaseStatus, 1000);
        });
    </script>
</body>
</html>
